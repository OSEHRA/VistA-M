SYNDHP28A ; HC/art - HealthConcourse - continuation of get Patient Prescription data ;08/28/2019
 ;;1.0;DHP;;Jan 17, 2017;Build 46
 ;;
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
 ;
 QUIT
 ;
RXCONT1 ; continuation of GET1PATRX^SYNDHP28 - get Patient Prescription data
 ;
 S PATRX("Patrx","pharmacyOrderableItem")=$G(PATRXARR(FNBR1,IENS1,39.2,"E"))
 S PATRX("Patrx","pharmacyOrderableItemId")=$G(PATRXARR(FNBR1,IENS1,39.2,"I"))
 S PATRX("Patrx","placerOrder")=$G(PATRXARR(FNBR1,IENS1,39.3,"E"))
 S PATRX("Patrx","previousOrder")=$G(PATRXARR(FNBR1,IENS1,39.4,"E"))
 S PATRX("Patrx","previousOrderId")=$G(PATRXARR(FNBR1,IENS1,39.4,"I"))
 S PATRX("Patrx","forwardOrder")=$G(PATRXARR(FNBR1,IENS1,39.5,"E"))
 S PATRX("Patrx","forwardOrderId")=$G(PATRXARR(FNBR1,IENS1,39.5,"I"))
 S PATRX("Patrx","wasThePatientCounseled")=$G(PATRXARR(FNBR1,IENS1,41,"E"))
 S PATRX("Patrx","wasThePatientCounseledCd")=$G(PATRXARR(FNBR1,IENS1,41,"I"))
 S PATRX("Patrx","wasCounselingUnderstood")=$G(PATRXARR(FNBR1,IENS1,42,"E"))
 S PATRX("Patrx","wasCounselingUnderstoodCd")=$G(PATRXARR(FNBR1,IENS1,42,"I"))
 S PATRX("Patrx","titrationDoseRx")=$G(PATRXARR(FNBR1,IENS1,45.1,"E"))
 S PATRX("Patrx","titrationDoseRxId")=$G(PATRXARR(FNBR1,IENS1,45.1,"I"))
 S PATRX("Patrx","maintenanceDoseRx")=$G(PATRXARR(FNBR1,IENS1,45.2,"E"))
 S PATRX("Patrx","maintenanceDoseRxId")=$G(PATRXARR(FNBR1,IENS1,45.2,"I"))
 S PATRX("Patrx","titrationRxFlag")=$G(PATRXARR(FNBR1,IENS1,45.3,"E"))
 S PATRX("Patrx","titrationRxFlagCd")=$G(PATRXARR(FNBR1,IENS1,45.3,"I"))
 S PATRX("Patrx","dawCode")=$G(PATRXARR(FNBR1,IENS1,81,"E"))
 S PATRX("Patrx","reTransmitFlag")=$G(PATRXARR(FNBR1,IENS1,82,"E"))
 S PATRX("Patrx","reTransmitFlagCd")=$G(PATRXARR(FNBR1,IENS1,82,"I"))
 S PATRX("Patrx","dateNdcValidated")=$G(PATRXARR(FNBR1,IENS1,83,"E"))
 S PATRX("Patrx","dateNdcValidatedFM")=$G(PATRXARR(FNBR1,IENS1,83,"I"))
 S PATRX("Patrx","dateNdcValidatedHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,83,"I")))
 S PATRX("Patrx","dateNdcValidatedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,83,"I")))
 S PATRX("Patrx","ndcValidatedBy")=$G(PATRXARR(FNBR1,IENS1,84,"E"))
 S PATRX("Patrx","ndcValidatedById")=$G(PATRXARR(FNBR1,IENS1,84,"I"))
 S PATRX("Patrx","billingEligibilityIndicator")=$G(PATRXARR(FNBR1,IENS1,85,"E"))
 S PATRX("Patrx","billingEligibilityIndicatorCd")=$G(PATRXARR(FNBR1,IENS1,85,"I"))
 S PATRX("Patrx","epharmacySuspenseHoldDate")=$G(PATRXARR(FNBR1,IENS1,86,"E"))
 S PATRX("Patrx","epharmacySuspenseHoldDateFM")=$G(PATRXARR(FNBR1,IENS1,86,"I"))
 S PATRX("Patrx","epharmacySuspenseHoldDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,86,"I")))
 S PATRX("Patrx","epharmacySuspenseHoldDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,86,"I")))
 S PATRX("Patrx","holdReason")=$G(PATRXARR(FNBR1,IENS1,99,"E"))
 S PATRX("Patrx","holdReasonCd")=$G(PATRXARR(FNBR1,IENS1,99,"I"))
 S PATRX("Patrx","holdComments")=$G(PATRXARR(FNBR1,IENS1,99.1,"E"))
 S PATRX("Patrx","holdDate")=$G(PATRXARR(FNBR1,IENS1,99.2,"E"))
 S PATRX("Patrx","holdDateFM")=$G(PATRXARR(FNBR1,IENS1,99.2,"I"))
 S PATRX("Patrx","holdDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,99.2,"I")))
 S PATRX("Patrx","holdDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,99.2,"I")))
 S PATRX("Patrx","status")=$G(PATRXARR(FNBR1,IENS1,100,"E"))
 S PATRX("Patrx","statusCd")=$G(PATRXARR(FNBR1,IENS1,100,"I"))
 S PATRX("Patrx","discontinueType")=$G(PATRXARR(FNBR1,IENS1,100.1,"E"))
 S PATRX("Patrx","discontinueTypeCd")=$G(PATRXARR(FNBR1,IENS1,100.1,"I"))
 S PATRX("Patrx","lastDispensedDate")=$G(PATRXARR(FNBR1,IENS1,101,"E"))
 S PATRX("Patrx","lastDispensedDateFM")=$G(PATRXARR(FNBR1,IENS1,101,"I"))
 S PATRX("Patrx","lastDispensedDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,101,"I")))
 S PATRX("Patrx","lastDispensedDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,101,"I")))
 S PATRX("Patrx","nextPossibleFill")=$G(PATRXARR(FNBR1,IENS1,102,"E"))
 S PATRX("Patrx","nextPossibleFillFM")=$G(PATRXARR(FNBR1,IENS1,102,"I"))
 S PATRX("Patrx","nextPossibleFillHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,102,"I")))
 S PATRX("Patrx","nextPossibleFillFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,102,"I")))
 S PATRX("Patrx","priorFillDate")=$G(PATRXARR(FNBR1,IENS1,102.1,"E"))
 S PATRX("Patrx","priorFillDateFM")=$G(PATRXARR(FNBR1,IENS1,102.1,"I"))
 S PATRX("Patrx","priorFillDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,102.1,"I")))
 S PATRX("Patrx","priorFillDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,102.1,"I")))
 S PATRX("Patrx","pendingNextPossibleFilldate")=$G(PATRXARR(FNBR1,IENS1,102.2,"E"))
 S PATRX("Patrx","pendingNextPossibleFilldateFM")=$G(PATRXARR(FNBR1,IENS1,102.2,"I"))
 S PATRX("Patrx","pendingNextPossibleFilldateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,102.2,"I")))
 S PATRX("Patrx","pendingNextPossibleFilldateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,102.2,"I")))
 S PATRX("Patrx","newDrug")=$G(PATRXARR(FNBR1,IENS1,103,"E"))
 S PATRX("Patrx","verifyingPharmacist")=$G(PATRXARR(FNBR1,IENS1,104,"E"))
 S PATRX("Patrx","verifyingPharmacistId")=$G(PATRXARR(FNBR1,IENS1,104,"I"))
 S PATRX("Patrx","verifyingPharmacistResId")=$$RESID^SYNDHP69("V",SITE,200,PATRX("Patrx","verifyingPharmacistId"))
 S PATRX("Patrx","copayTransactionType")=$G(PATRXARR(FNBR1,IENS1,105,"E"))
 S PATRX("Patrx","copayTransactionTypeId")=$G(PATRXARR(FNBR1,IENS1,105,"I"))
 S PATRX("Patrx","ibNumber")=$G(PATRXARR(FNBR1,IENS1,106,"E"))
 S PATRX("Patrx","ibNumberId")=$G(PATRXARR(FNBR1,IENS1,106,"I"))
 S PATRX("Patrx","copayTypeAudit")=$G(PATRXARR(FNBR1,IENS1,106.5,"E"))
 S PATRX("Patrx","copayExceedingCap")=$G(PATRXARR(FNBR1,IENS1,106.6,"E"))
 S PATRX("Patrx","copayExceedingCapId")=$G(PATRXARR(FNBR1,IENS1,106.6,"I"))
 S PATRX("Patrx","deletionComments")=$G(PATRXARR(FNBR1,IENS1,108,"E"))
 S PATRX("Patrx","cosigningPhysician")=$G(PATRXARR(FNBR1,IENS1,109,"E"))
 S PATRX("Patrx","cosigningPhysicianId")=$G(PATRXARR(FNBR1,IENS1,109,"I"))
 S PATRX("Patrx","cosigningPhysicianNPI")=$$GET1^DIQ(200,PATRX("Patrx","cosigningPhysicianId")_",",41.99) ;NPI
 S PATRX("Patrx","cosigningPhysicianResId")=$$RESID^SYNDHP69("V",SITE,200,PATRX("Patrx","cosigningPhysicianId"))
 S PATRX("Patrx","typeOfRx")=$G(PATRXARR(FNBR1,IENS1,110,"E"))
 S PATRX("Patrx","poeRx")=$G(PATRXARR(FNBR1,IENS1,111,"E"))
 S PATRX("Patrx","poeRxCd")=$G(PATRXARR(FNBR1,IENS1,111,"I"))
 S PATRX("Patrx","originalQty")=$G(PATRXARR(FNBR1,IENS1,112,"E"))
 S PATRX("Patrx","patientInstructions")=$G(PATRXARR(FNBR1,IENS1,114,"E"))
 S PATRX("Patrx","otherPatientInstructions")=$G(PATRXARR(FNBR1,IENS1,114.1,"E"))
 S PATRX("Patrx","expandedPatientInstructions")=""
 N Z S Z=""
 F  S Z=$O(PATRXARR(FNBR1,IENS1,115,Z)) QUIT:'+Z  D
 . S PATRX("Patrx","expandedPatientInstructions")=PATRX("Patrx","expandedPatientInstructions")_$G(PATRXARR(FNBR1,IENS1,115,Z))
 S PATRX("Patrx","serviceConnected")=$G(PATRXARR(FNBR1,IENS1,116,"E"))
 S PATRX("Patrx","serviceConnectedCd")=$G(PATRXARR(FNBR1,IENS1,116,"I"))
 S PATRX("Patrx","militarySexualTrauma")=$G(PATRXARR(FNBR1,IENS1,117,"E"))
 S PATRX("Patrx","militarySexualTraumaCd")=$G(PATRXARR(FNBR1,IENS1,117,"I"))
 S PATRX("Patrx","agentOrangeExposure")=$G(PATRXARR(FNBR1,IENS1,118,"E"))
 S PATRX("Patrx","agentOrangeExposureCd")=$G(PATRXARR(FNBR1,IENS1,118,"I"))
 S PATRX("Patrx","ionizingRadiationExposure")=$G(PATRXARR(FNBR1,IENS1,119,"E"))
 S PATRX("Patrx","ionizingRadiationExposureCd")=$G(PATRXARR(FNBR1,IENS1,119,"I"))
 S PATRX("Patrx","southwestAsiaConditions")=$G(PATRXARR(FNBR1,IENS1,120,"E"))
 S PATRX("Patrx","southwestAsiaConditionsCd")=$G(PATRXARR(FNBR1,IENS1,120,"I"))
 S PATRX("Patrx","ddstatus")=$G(PATRXARR(FNBR1,IENS1,120.01,"E"))
 S PATRX("Patrx","dateOfDeathHistory")=$G(PATRXARR(FNBR1,IENS1,120.02,"E"))
 S PATRX("Patrx","headAndOrNeckCancer")=$G(PATRXARR(FNBR1,IENS1,121,"E"))
 S PATRX("Patrx","headAndOrNeckCancerCd")=$G(PATRXARR(FNBR1,IENS1,121,"I"))
 S PATRX("Patrx","combatVeteran")=$G(PATRXARR(FNBR1,IENS1,122,"E"))
 S PATRX("Patrx","combatVeteranCd")=$G(PATRXARR(FNBR1,IENS1,122,"I"))
 S PATRX("Patrx","proj112Shad")=$G(PATRXARR(FNBR1,IENS1,122.01,"E"))
 S PATRX("Patrx","proj112ShadCd")=$G(PATRXARR(FNBR1,IENS1,122.01,"I"))
 S PATRX("Patrx","externalPlacerOrderNumber")=$G(PATRXARR(FNBR1,IENS1,123,"E"))
 S PATRX("Patrx","externalApplication")=$G(PATRXARR(FNBR1,IENS1,124,"E"))
 S PATRX("Patrx","pfssAccountReference")=$G(PATRXARR(FNBR1,IENS1,125,"E"))
 S PATRX("Patrx","pfssAccountReferenceId")=$G(PATRXARR(FNBR1,IENS1,125,"I"))
 S PATRX("Patrx","pfssChargeId")=$G(PATRXARR(FNBR1,IENS1,126,"E"))
 S PATRX("Patrx","lastDispensedDateHolder")=$G(PATRXARR(FNBR1,IENS1,127,"E"))
 S PATRX("Patrx","lastDispensedDateHolderFM")=$G(PATRXARR(FNBR1,IENS1,127,"I"))
 S PATRX("Patrx","lastDispensedDateHolderHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,127,"I")))
 S PATRX("Patrx","lastDispensedDateHolderFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,127,"I")))
 S PATRX("Patrx","tpbRx")=$G(PATRXARR(FNBR1,IENS1,201,"E"))
 S PATRX("Patrx","tpbRxCd")=$G(PATRXARR(FNBR1,IENS1,201,"I"))
 S PATRX("Patrx","clozapineDosageMgDay")=$G(PATRXARR(FNBR1,IENS1,301,"E"))
 S PATRX("Patrx","wbcResults")=$G(PATRXARR(FNBR1,IENS1,302,"E"))
 S PATRX("Patrx","dateOfWbcTest")=$G(PATRXARR(FNBR1,IENS1,303,"E"))
 S PATRX("Patrx","dateOfWbcTestFM")=$G(PATRXARR(FNBR1,IENS1,303,"I"))
 S PATRX("Patrx","dateOfWbcTestHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR1,IENS1,303,"I")))
 S PATRX("Patrx","dateOfWbcTestFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR1,IENS1,303,"I")))
 S PATRX("Patrx","ancResults")=$G(PATRXARR(FNBR1,IENS1,304,"E"))
 S PATRX("Patrx","signatureStatus")=$G(PATRXARR(FNBR1,IENS1,310,"E"))
 S PATRX("Patrx","signatureStatusCd")=$G(PATRXARR(FNBR1,IENS1,310,"I"))
 S PATRX("Patrx","backdoorSignatureStatus")=$G(PATRXARR(FNBR1,IENS1,311,"E"))
 S PATRX("Patrx","backdoorSignatureStatusCd")=$G(PATRXARR(FNBR1,IENS1,311,"I"))
 S PATRX("Patrx","hospitalCoverage")=$G(PATRXARR(FNBR1,IENS1,521011,"E"))
 ;
 N IENS2 S IENS2=""
 F  S IENS2=$O(PATRXARR(FNBR2,IENS2)) QUIT:IENS2=""  D
 . N VERIFY S VERIFY=$NA(PATRX("Patrx","rxVerifys","rxVerify",+IENS2))
 . S @VERIFY@("rx")=$G(PATRXARR(FNBR2,IENS2,.01,"E"))
 . S @VERIFY@("rxId")=$G(PATRXARR(FNBR2,IENS2,.01,"I"))
 . S @VERIFY@("patientName")=$G(PATRXARR(FNBR2,IENS2,1,"E"))
 . S @VERIFY@("patientNameId")=$G(PATRXARR(FNBR2,IENS2,1,"I"))
 . S @VERIFY@("patientNameICN")=$$GET1^DIQ(2,@VERIFY@("patientNameId")_",",991.1)
 . S @VERIFY@("clerk")=$G(PATRXARR(FNBR2,IENS2,2,"E"))
 . S @VERIFY@("clerkId")=$G(PATRXARR(FNBR2,IENS2,2,"I"))
 . S @VERIFY@("renewedFromRx")=$G(PATRXARR(FNBR2,IENS2,3,"E"))
 . S @VERIFY@("renewedFromRxId")=$G(PATRXARR(FNBR2,IENS2,3,"I"))
 . S @VERIFY@("loginDate")=$G(PATRXARR(FNBR2,IENS2,4,"E"))
 . S @VERIFY@("loginDateFM")=$G(PATRXARR(FNBR2,IENS2,4,"I"))
 . S @VERIFY@("loginDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR2,IENS2,4,"I")))
 . S @VERIFY@("loginDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR2,IENS2,4,"I")))
 . S @VERIFY@("psorxd0")=$G(PATRXARR(FNBR2,IENS2,5,"E"))
 . S @VERIFY@("psorxexp")=$G(PATRXARR(FNBR2,IENS2,6,"E"))
 . S @VERIFY@("drugInteraction")=$G(PATRXARR(FNBR2,IENS2,7,"E"))
 . S @VERIFY@("drugInteractionCd")=$G(PATRXARR(FNBR2,IENS2,7,"I"))
 . S @VERIFY@("severity")=$G(PATRXARR(FNBR2,IENS2,7.1,"E"))
 . S @VERIFY@("affectedMedication")=$G(PATRXARR(FNBR2,IENS2,7.2,"E"))
 . S @VERIFY@("doseWarning")=$G(PATRXARR(FNBR2,IENS2,8,"E"))
 . S @VERIFY@("doseWarningCd")=$G(PATRXARR(FNBR2,IENS2,8,"I"))
 . S @VERIFY@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR2_U_+IENS2)
 ;
 N IENS3 S IENS3=""
 F  S IENS3=$O(PATRXARR(FNBR3,IENS3)) QUIT:IENS3=""  D
 . N LABEL S LABEL=$NA(PATRX("Patrx","labelDateTimes","labelDateTime",+IENS3))
 . S @LABEL@("labelDateTime")=$G(PATRXARR(FNBR3,IENS3,.01,"E"))
 . S @LABEL@("labelDateTimeFM")=$G(PATRXARR(FNBR3,IENS3,.01,"I"))
 . S @LABEL@("labelDateTimeHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR3,IENS3,.01,"I")))
 . S @LABEL@("labelDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR3,IENS3,.01,"I")))
 . S @LABEL@("rxReference")=$G(PATRXARR(FNBR3,IENS3,1,"E"))
 . S @LABEL@("labelComment")=$G(PATRXARR(FNBR3,IENS3,2,"E"))
 . S @LABEL@("printedBy")=$G(PATRXARR(FNBR3,IENS3,3,"E"))
 . S @LABEL@("printedById")=$G(PATRXARR(FNBR3,IENS3,3,"I"))
 . S @LABEL@("warningLabelType")=$G(PATRXARR(FNBR3,IENS3,4,"E"))
 . S @LABEL@("warningLabelTypeCd")=$G(PATRXARR(FNBR3,IENS3,4,"I"))
 . S @LABEL@("device")=$G(PATRXARR(FNBR3,IENS3,5,"E"))
 . S @LABEL@("fdaMedGuideFilename")=$G(PATRXARR(FNBR3,IENS3,35,"E"))
 . S @LABEL@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR3_U_+IENS3)
 ;
 N IENS4 S IENS4=""
 F  S IENS4=$O(PATRXARR(FNBR4,IENS4)) QUIT:IENS4=""  D
 . N ALLERGY S ALLERGY=$NA(PATRX("Patrx","drugAllergyIngredientss","drugAllergyIngredients",+IENS4))
 . S @ALLERGY@("ingredients")=$G(PATRXARR(FNBR4,IENS4,.01,"E"))
 . S @ALLERGY@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR4_U_+IENS4)
 ;
 ;
 QUIT
 ;
