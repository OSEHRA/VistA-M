SYNDHP28B ; HC/art - HealthConcourse - continuation of get Patient Prescription data ;08/28/2019
 ;;1.0;DHP;;Jan 17, 2017;Build 46
 ;;
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
 ;
 QUIT
 ;
RXCONT2 ; continuation of GET1PATRX^SYNDHP28 - get Patient Prescription data
 ;
 N IENS5 S IENS5=""
 F  S IENS5=$O(PATRXARR(FNBR5,IENS5)) QUIT:IENS5=""  D
 . N ROUTES S ROUTES=$NA(PATRX("Patrx","medicationRoutess","medicationRoutes",+IENS5))
 . S @ROUTES@("medicationRoutes")=$G(PATRXARR(FNBR5,IENS5,.01,"E"))
 . S @ROUTES@("medicationRoutesId")=$G(PATRXARR(FNBR5,IENS5,.01,"I"))
 . S @ROUTES@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR5_U_+IENS5)
 ;
 N IENS6 S IENS6=""
 F  S IENS6=$O(PATRXARR(FNBR6,IENS6)) QUIT:IENS6=""  D
 . N SCHED S SCHED=$NA(PATRX("Patrx","scheduless","schedules",+IENS6))
 . S @SCHED@("schedules")=$G(PATRXARR(FNBR6,IENS6,.01,"E"))
 . S @SCHED@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR6_U_+IENS6)
 ;
 N IENS7 S IENS7=""
 F  S IENS7=$O(PATRXARR(FNBR7,IENS7)) QUIT:IENS7=""  D
 . N ACTLOG S ACTLOG=$NA(PATRX("Patrx","activityLogs","activityLog",+IENS7))
 . S @ACTLOG@("activityLog")=$G(PATRXARR(FNBR7,IENS7,.01,"E"))
 . S @ACTLOG@("activityLogFM")=$G(PATRXARR(FNBR7,IENS7,.01,"I"))
 . S @ACTLOG@("activityLogHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR7,IENS7,.01,"I")))
 . S @ACTLOG@("activityLogFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR7,IENS7,.01,"I")))
 . S @ACTLOG@("reason")=$G(PATRXARR(FNBR7,IENS7,.02,"E"))
 . S @ACTLOG@("reasonCd")=$G(PATRXARR(FNBR7,IENS7,.02,"I"))
 . S @ACTLOG@("initiatorOfActivity")=$G(PATRXARR(FNBR7,IENS7,.03,"E"))
 . S @ACTLOG@("initiatorOfActivityId")=$G(PATRXARR(FNBR7,IENS7,.03,"I"))
 . S @ACTLOG@("rxReference")=$G(PATRXARR(FNBR7,IENS7,.04,"E"))
 . S @ACTLOG@("comment")=$G(PATRXARR(FNBR7,IENS7,.05,"E"))
 . S @ACTLOG@("fieldEdited")=$G(PATRXARR(FNBR7,IENS7,1,"E"))
 . S @ACTLOG@("oldValue")=$G(PATRXARR(FNBR7,IENS7,2,"E"))
 . S @ACTLOG@("newValue")=$G(PATRXARR(FNBR7,IENS7,3,"E"))
 . S @ACTLOG@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR7_U_+IENS7)
 ;
 N IENS16 S IENS16=""
 F  S IENS16=$O(PATRXARR(FNBR16,IENS16)) QUIT:IENS16=""  D
 . N ACTLOGCOM S ACTLOGCOM=$NA(PATRX("Patrx","activityLogs","activityLog",$P(IENS16,C,2),"otherCommentss","otherComments",+IENS16))
 . S @ACTLOGCOM@("otherComments")=$G(PATRXARR(FNBR16,IENS16,.01,"E"))
 . S @ACTLOGCOM@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR7_U_$P(IENS16,C,2)_U_FNBR16_U_+IENS16)
 ;
 N IENS8 S IENS8=""
 F  S IENS8=$O(PATRXARR(FNBR8,IENS8)) QUIT:IENS8=""  D
 . N REFILLS S REFILLS=$NA(PATRX("Patrx","refills","refill",+IENS8))
 . S @REFILLS@("refillDate")=$G(PATRXARR(FNBR8,IENS8,.01,"E"))
 . S @REFILLS@("refillDateFM")=$G(PATRXARR(FNBR8,IENS8,.01,"I"))
 . S @REFILLS@("refillDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,.01,"I")))
 . S @REFILLS@("refillDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,.01,"I")))
 . S @REFILLS@("qty")=$G(PATRXARR(FNBR8,IENS8,1,"E"))
 . S @REFILLS@("daysSupply")=$G(PATRXARR(FNBR8,IENS8,1.1,"E"))
 . S @REFILLS@("currentUnitPriceOfDrug")=$G(PATRXARR(FNBR8,IENS8,1.2,"E"))
 . S @REFILLS@("mailWindow")=$G(PATRXARR(FNBR8,IENS8,2,"E"))
 . S @REFILLS@("mailWindowCd")=$G(PATRXARR(FNBR8,IENS8,2,"I"))
 . S @REFILLS@("remarks")=$G(PATRXARR(FNBR8,IENS8,3,"E"))
 . S @REFILLS@("pharmacistName")=$G(PATRXARR(FNBR8,IENS8,4,"E"))
 . S @REFILLS@("pharmacistNameId")=$G(PATRXARR(FNBR8,IENS8,4,"I"))
 . S @REFILLS@("lot")=$G(PATRXARR(FNBR8,IENS8,5,"E"))
 . S @REFILLS@("clerkCode")=$G(PATRXARR(FNBR8,IENS8,6,"E"))
 . S @REFILLS@("clerkCodeId")=$G(PATRXARR(FNBR8,IENS8,6,"I"))
 . S @REFILLS@("loginDate")=$G(PATRXARR(FNBR8,IENS8,7,"E"))
 . S @REFILLS@("loginDateFM")=$G(PATRXARR(FNBR8,IENS8,7,"I"))
 . S @REFILLS@("loginDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,7,"I")))
 . S @REFILLS@("loginDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,7,"I")))
 . S @REFILLS@("division")=$G(PATRXARR(FNBR8,IENS8,8,"E"))
 . S @REFILLS@("divisionId")=$G(PATRXARR(FNBR8,IENS8,8,"I"))
 . S @REFILLS@("ibNumber")=$G(PATRXARR(FNBR8,IENS8,9,"E"))
 . S @REFILLS@("ibNumberId")=$G(PATRXARR(FNBR8,IENS8,9,"I"))
 . S @REFILLS@("copayExceedingCap")=$G(PATRXARR(FNBR8,IENS8,9.1,"E"))
 . S @REFILLS@("copayExceedingCapId")=$G(PATRXARR(FNBR8,IENS8,9.1,"I"))
 . S @REFILLS@("dispensedDate")=$G(PATRXARR(FNBR8,IENS8,10.1,"E"))
 . S @REFILLS@("dispensedDateFM")=$G(PATRXARR(FNBR8,IENS8,10.1,"I"))
 . S @REFILLS@("dispensedDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,10.1,"I")))
 . S @REFILLS@("dispensedDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,10.1,"I")))
 . S @REFILLS@("ndc")=$G(PATRXARR(FNBR8,IENS8,11,"E"))
 . S @REFILLS@("manufacturer")=$G(PATRXARR(FNBR8,IENS8,12,"E"))
 . S @REFILLS@("drugExpirationDate")=$G(PATRXARR(FNBR8,IENS8,13,"E"))
 . S @REFILLS@("drugExpirationDateFM")=$G(PATRXARR(FNBR8,IENS8,13,"I"))
 . S @REFILLS@("drugExpirationDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,13,"I")))
 . S @REFILLS@("drugExpirationDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,13,"I")))
 . S @REFILLS@("returnedToStock")=$G(PATRXARR(FNBR8,IENS8,14,"E"))
 . S @REFILLS@("returnedToStockFM")=$G(PATRXARR(FNBR8,IENS8,14,"I"))
 . S @REFILLS@("returnedToStockHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,14,"I")))
 . S @REFILLS@("returnedToStockFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,14,"I")))
 . S @REFILLS@("provider")=$G(PATRXARR(FNBR8,IENS8,15,"E"))
 . S @REFILLS@("providerId")=$G(PATRXARR(FNBR8,IENS8,15,"I"))
 . S @REFILLS@("providerNPI")=$$GET1^DIQ(200,@REFILLS@("providerId")_",",41.99) ;NPI
 . S @REFILLS@("providerResId")=$$RESID^SYNDHP69("V",SITE,200,@REFILLS@("providerId"))
 . S @REFILLS@("genericProvider")=$G(PATRXARR(FNBR8,IENS8,16,"E"))
 . S @REFILLS@("releasedDateTime")=$G(PATRXARR(FNBR8,IENS8,17,"E"))
 . S @REFILLS@("releasedDateTimeFM")=$G(PATRXARR(FNBR8,IENS8,17,"I"))
 . S @REFILLS@("releasedDateTimeHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,17,"I")))
 . S @REFILLS@("releasedDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,17,"I")))
 . S @REFILLS@("bingoWaitTime")=$G(PATRXARR(FNBR8,IENS8,18,"E"))
 . S @REFILLS@("fillingPerson")=$G(PATRXARR(FNBR8,IENS8,19,"E"))
 . S @REFILLS@("fillingPersonId")=$G(PATRXARR(FNBR8,IENS8,19,"I"))
 . S @REFILLS@("checkingPharmacist")=$G(PATRXARR(FNBR8,IENS8,20,"E"))
 . S @REFILLS@("checkingPharmacistId")=$G(PATRXARR(FNBR8,IENS8,20,"I"))
 . S @REFILLS@("checkingPharmacistResId")=$$RESID^SYNDHP69("V",SITE,200,@REFILLS@("checkingPharmacistId"))
 . S @REFILLS@("pfssAccountReference")=$G(PATRXARR(FNBR8,IENS8,21,"E"))
 . S @REFILLS@("pfssAccountReferenceId")=$G(PATRXARR(FNBR8,IENS8,21,"I"))
 . S @REFILLS@("pfssChargeId")=$G(PATRXARR(FNBR8,IENS8,22,"E"))
 . S @REFILLS@("administeredInClinic")=$G(PATRXARR(FNBR8,IENS8,23,"E"))
 . S @REFILLS@("administeredInClinicCd")=$G(PATRXARR(FNBR8,IENS8,23,"I"))
 . S @REFILLS@("dawCode")=$G(PATRXARR(FNBR8,IENS8,81,"E"))
 . S @REFILLS@("reTransmitFlag")=$G(PATRXARR(FNBR8,IENS8,82,"E"))
 . S @REFILLS@("reTransmitFlagCd")=$G(PATRXARR(FNBR8,IENS8,82,"I"))
 . S @REFILLS@("dateNdcValidated")=$G(PATRXARR(FNBR8,IENS8,83,"E"))
 . S @REFILLS@("dateNdcValidatedFM")=$G(PATRXARR(FNBR8,IENS8,83,"I"))
 . S @REFILLS@("dateNdcValidatedHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,83,"I")))
 . S @REFILLS@("dateNdcValidatedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,83,"I")))
 . S @REFILLS@("ndcValidatedBy")=$G(PATRXARR(FNBR8,IENS8,84,"E"))
 . S @REFILLS@("ndcValidatedById")=$G(PATRXARR(FNBR8,IENS8,84,"I"))
 . S @REFILLS@("billingEligibilityIndicator")=$G(PATRXARR(FNBR8,IENS8,85,"E"))
 . S @REFILLS@("billingEligibilityIndicatorCd")=$G(PATRXARR(FNBR8,IENS8,85,"I"))
 . S @REFILLS@("epharmacySuspenseHoldDate")=$G(PATRXARR(FNBR8,IENS8,86,"E"))
 . S @REFILLS@("epharmacySuspenseHoldDateFM")=$G(PATRXARR(FNBR8,IENS8,86,"I"))
 . S @REFILLS@("epharmacySuspenseHoldDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR8,IENS8,86,"I")))
 . S @REFILLS@("epharmacySuspenseHoldDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR8,IENS8,86,"I")))
 . S @REFILLS@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR8_U_+IENS8)
 ;
 N IENS9 S IENS9=""
 F  S IENS9=$O(PATRXARR(FNBR9,IENS9)) QUIT:IENS9=""  D
 . N REJECT S REJECT=$NA(PATRX("Patrx","rejectInfos","rejectInfo",+IENS9))
 . S @REJECT@("ncpdpRejectCode")=$G(PATRXARR(FNBR9,IENS9,.01,"E"))
 . S @REJECT@("dateTimeDetected")=$G(PATRXARR(FNBR9,IENS9,1,"E"))
 . S @REJECT@("dateTimeDetectedFM")=$G(PATRXARR(FNBR9,IENS9,1,"I"))
 . S @REJECT@("dateTimeDetectedHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR9,IENS9,1,"I")))
 . S @REJECT@("dateTimeDetectedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR9,IENS9,1,"I")))
 . S @REJECT@("payerMessage")=$G(PATRXARR(FNBR9,IENS9,2,"E"))
 . S @REJECT@("reason")=$G(PATRXARR(FNBR9,IENS9,3,"E"))
 . S @REJECT@("pharmacist")=$G(PATRXARR(FNBR9,IENS9,4,"E"))
 . S @REJECT@("pharmacistId")=$G(PATRXARR(FNBR9,IENS9,4,"I"))
 . S @REJECT@("pharmacistResId")=$$RESID^SYNDHP69("V",SITE,200,@REJECT@("pharmacistId"))
 . S @REJECT@("fillNumber")=$G(PATRXARR(FNBR9,IENS9,5,"E"))
 . S @REJECT@("groupName")=$G(PATRXARR(FNBR9,IENS9,6,"E"))
 . S @REJECT@("planContact")=$G(PATRXARR(FNBR9,IENS9,7,"E"))
 . S @REJECT@("planPreviousFillDate")=$G(PATRXARR(FNBR9,IENS9,8,"E"))
 . S @REJECT@("planPreviousFillDateFM")=$G(PATRXARR(FNBR9,IENS9,8,"I"))
 . S @REJECT@("planPreviousFillDateHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR9,IENS9,8,"I")))
 . S @REJECT@("planPreviousFillDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR9,IENS9,8,"I")))
 . S @REJECT@("status")=$G(PATRXARR(FNBR9,IENS9,9,"E"))
 . S @REJECT@("statusCd")=$G(PATRXARR(FNBR9,IENS9,9,"I"))
 . S @REJECT@("closedDateTime")=$G(PATRXARR(FNBR9,IENS9,10,"E"))
 . S @REJECT@("closedDateTimeFM")=$G(PATRXARR(FNBR9,IENS9,10,"I"))
 . S @REJECT@("closedDateTimeHL7")=$$FMTHL7^XLFDT($G(PATRXARR(FNBR9,IENS9,10,"I")))
 . S @REJECT@("closedDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATRXARR(FNBR9,IENS9,10,"I")))
 . S @REJECT@("closedBy")=$G(PATRXARR(FNBR9,IENS9,11,"E"))
 . S @REJECT@("closedById")=$G(PATRXARR(FNBR9,IENS9,11,"I"))
 . S @REJECT@("closeReason")=$G(PATRXARR(FNBR9,IENS9,12,"E"))
 . S @REJECT@("closeReasonCd")=$G(PATRXARR(FNBR9,IENS9,12,"I"))
 . S @REJECT@("closeComments")=$G(PATRXARR(FNBR9,IENS9,13,"E"))
 . S @REJECT@("reasonForServiceCode")=$G(PATRXARR(FNBR9,IENS9,14,"E"))
 . S @REJECT@("professionalServiceCode")=$G(PATRXARR(FNBR9,IENS9,15,"E"))
 . S @REJECT@("responseId")=$G(PATRXARR(FNBR9,IENS9,16,"E"))
 . S @REJECT@("otherRejects")=$G(PATRXARR(FNBR9,IENS9,17,"E"))
 . S @REJECT@("durText")=$G(PATRXARR(FNBR9,IENS9,18,"E"))
 . S @REJECT@("resultOfServiceCode")=$G(PATRXARR(FNBR9,IENS9,19,"E"))
 . S @REJECT@("insuranceName")=$G(PATRXARR(FNBR9,IENS9,20,"E"))
 . S @REJECT@("groupNumber")=$G(PATRXARR(FNBR9,IENS9,21,"E"))
 . S @REJECT@("cardholderId")=$G(PATRXARR(FNBR9,IENS9,22,"E"))
 . S @REJECT@("reOpened")=$G(PATRXARR(FNBR9,IENS9,23,"E"))
 . S @REJECT@("reOpenedCd")=$G(PATRXARR(FNBR9,IENS9,23,"I"))
 . S @REJECT@("clarificationCode")=$G(PATRXARR(FNBR9,IENS9,24,"E"))
 . S @REJECT@("priorAuthorizationType")=$G(PATRXARR(FNBR9,IENS9,25,"E"))
 . S @REJECT@("priorAuthorizationNumber")=$G(PATRXARR(FNBR9,IENS9,26,"E"))
 . S @REJECT@("coordinationOfBenefits")=$G(PATRXARR(FNBR9,IENS9,27,"E"))
 . S @REJECT@("coordinationOfBenefitsCd")=$G(PATRXARR(FNBR9,IENS9,27,"I"))
 . S @REJECT@("durAddMsgText")=$G(PATRXARR(FNBR9,IENS9,28,"E"))
 . S @REJECT@("bin")=$G(PATRXARR(FNBR9,IENS9,29,"E"))
 . S @REJECT@("rrrFlag")=$G(PATRXARR(FNBR9,IENS9,30,"E"))
 . S @REJECT@("rrrFlagCd")=$G(PATRXARR(FNBR9,IENS9,30,"I"))
 . S @REJECT@("rrrDollarThreshold")=$G(PATRXARR(FNBR9,IENS9,31,"E"))
 . S @REJECT@("rrrGrossAmountDue")=$G(PATRXARR(FNBR9,IENS9,32,"E"))
 . S @REJECT@("insuranceCompany")=$G(PATRXARR(FNBR9,IENS9,33,"E"))
 . S @REJECT@("resourceId")=$$RESID^SYNDHP69("V",SITE,FNBR1,PATRXIEN,FNBR9_U_+IENS9)
 ;
 QUIT
 ;
